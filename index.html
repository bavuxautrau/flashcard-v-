<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Web Há»c Tá»« Vá»±ng IPA + áº¢nh</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body { font-family: Arial, sans-serif; background:#f0f8ff; display:flex; flex-direction:column; align-items:center; padding:18px; }
h1 { color:#333; margin:6px 0 14px 0; }
.flashcard { width:360px; height:300px; border:2px solid #333; border-radius:10px; display:flex; justify-content:center; align-items:center; text-align:center; background-color:#fff; margin:12px; font-size:24px; cursor:pointer; transition: transform 0.6s; transform-style: preserve-3d; perspective:1000px; position:relative; }
.flashcard.flipped { transform: rotateY(180deg); }
.front, .back { position:absolute; width:320px; height:260px; backface-visibility:hidden; display:flex; flex-direction:column; justify-content:flex-start; align-items:center; border-radius:10px; padding:12px; box-sizing:border-box; overflow:auto; }
.back { transform: rotateY(180deg); background-color:#fff6f2; }
.phonetic { font-size:15px; margin-top:8px; color:#444; font-style:italic; }
.flash-img { max-width:90%; max-height:140px; margin-top:10px; border-radius:8px; object-fit:cover; border:1px solid #ddd; }
.controls, .inputs, .modes { display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin:8px 0; }
.inputs input[type="text"] { padding:8px; font-size:15px; width:180px; border-radius:6px; border:1px solid #bbb; }
button { padding:8px 10px; border-radius:6px; border:1px solid #888; background:#fff; cursor:pointer; }
.small { padding:6px 8px; font-size:14px; }
table { border-collapse: collapse; margin-top:10px; width:90%; max-width:960px; }
th, td { border:1px solid #333; padding:6px 8px; text-align:center; font-size:14px; }
.thumbnail { width:60px; height:40px; object-fit:cover; border-radius:4px; }
#resultPronounce { margin-top:8px; font-weight:600; color:#006400; min-height:20px; }
.note { font-size:13px; color:#666; margin-top:4px; }
</style>
</head>
<body>

<h1>Web Há»c Tá»« Vá»±ng IPA + áº¢nh</h1>

<!-- Flashcard -->
<div class="flashcard" id="flashcard" title="Báº¥m Ä‘á»ƒ láº­t">
  <div class="front" id="front">Click Ä‘á»ƒ láº­t</div>
  <div class="back" id="back"></div>
</div>

<!-- Inputs -->
<div class="inputs">
  <input type="text" id="newWord" placeholder="Tá»« tiáº¿ng Anh (vd: dog)">
  <input type="text" id="newMeaning" placeholder="NghÄ©a tiáº¿ng Viá»‡t">
  <input type="text" id="newCategory" placeholder="Danh má»¥c (vd: Ä‘á»™ng váº­t)">
  <input type="text" id="newImage" placeholder="URL áº£nh (tÃ¹y chá»n)">
</div>

<div class="controls">
  <button onclick="pasteImageUrl()" class="small">ğŸ“‹ DÃ¡n URL áº£nh</button>
  <button onclick="setUnsplashToInput()" class="small">ğŸ”€ áº¢nh Unsplash</button>
  <button onclick="addWord()">â• ThÃªm tá»« má»›i</button>
  <button onclick="nextWord()">â­ Tá»« tiáº¿p theo</button>
  <button onclick="markKnown()">âœ… ÄÃ£ thuá»™c</button>
  <button onclick="markUnknown()" class="small">âŒ ChÆ°a thuá»™c</button>
  <button onclick="playPronunciation()" class="small">ğŸ”Š PhÃ¡t Ã¢m</button>
  <button id="speakBtn" class="small">ğŸ¤ NÃ³i tá»«</button>
  <button onclick="copyCurrentImageUrl()" class="small">ğŸ“‹ Sao chÃ©p URL áº£nh</button>
  <button onclick="changeUnsplashImage()" class="small">ğŸ”„ Äá»•i áº£nh</button>
  <button onclick="requestNotificationPermission()" class="small">ğŸ”” Báº­t thÃ´ng bÃ¡o</button>
</div>

<!-- Mode chá»n há»c -->
<div class="modes">
  <button onclick="reviewUnknown()">ğŸ“˜ Há»c tá»« chÆ°a thuá»™c</button>
  <button onclick="reviewKnown()">ğŸ“— Ã”n láº¡i tá»« Ä‘Ã£ thuá»™c</button>
</div>

<p id="resultPronounce"></p>
<p class="note">Ghi chÃº: cÃ³ thá»ƒ nháº­p URL áº£nh hoáº·c Ä‘á»ƒ trá»‘ng Ä‘á»ƒ tá»± láº¥y áº£nh tá»« Unsplash.</p>

<!-- Danh sÃ¡ch tá»« -->
<h3>Danh sÃ¡ch tá»« (Sá»­a / XÃ³a / áº¢nh)</h3>
<select id="filterCategory" onchange="renderTable()">
  <option value="">Táº¥t cáº£ danh má»¥c</option>
</select>
<table id="wordTable">
  <thead>
    <tr><th>Tá»«</th><th>NghÄ©a</th><th>Danh má»¥c</th><th>áº¢nh</th><th>ÄÃ£ thuá»™c</th><th>HÃ nh Ä‘á»™ng</th></tr>
  </thead>
  <tbody></tbody>
</table>

<script>
// ==== Dá»¯ liá»‡u ====
let words = JSON.parse(localStorage.getItem('words')) || [];
let currentIndex = 0;
let mode = "unknown"; // "unknown" = há»c tá»« chÆ°a thuá»™c, "known" = Ã´n láº¡i tá»« Ä‘Ã£ thuá»™c

const flashcard = document.getElementById('flashcard');
const front = document.getElementById('front');
const back = document.getElementById('back');
const wordTable = document.querySelector('#wordTable tbody');
const filterCategory = document.getElementById('filterCategory');
const speakBtn = document.getElementById('speakBtn');
const resultPronounce = document.getElementById('resultPronounce');

// ==== Hiá»ƒn thá»‹ tá»« ====
function getActiveWords(){
  let list = (mode === "known") ? words.filter(w=>w.known) : words.filter(w=>!w.known);
  if(filterCategory.value) list = list.filter(w => w.category === filterCategory.value);
  return list;
}
async function showWord(){
  const active = getActiveWords();
  if(active.length === 0){
    front.textContent = (mode==="known")?"ChÆ°a cÃ³ tá»« Ä‘á»ƒ Ã´n":"ChÆ°a cÃ³ tá»« Ä‘á»ƒ há»c";
    back.innerHTML = "";
    return;
  }
  currentIndex = currentIndex % active.length;
  const w = active[currentIndex];
  if(!w.phonetic) w.phonetic = await fetchIPA(w.eng);
  if(!w.image) w.image = getUnsplashUrl(w.eng);
  front.textContent = w.eng;
  back.innerHTML = `
    <div style="font-size:18px;font-weight:600;margin-top:6px;">${w.vi}</div>
    <div class="phonetic">[${w.phonetic}]</div>
    ${w.image?`<img src="${w.image}" class="flash-img">`:""}
  `;
  localStorage.setItem('words', JSON.stringify(words));
  flashcard.classList.remove('flipped');
}
flashcard.addEventListener('click', ()=> flashcard.classList.toggle('flipped'));
function nextWord(){ currentIndex++; showWord(); }

// ==== Mode ====
function reviewKnown(){ mode="known"; currentIndex=0; showWord(); }
function reviewUnknown(){ mode="unknown"; currentIndex=0; showWord(); }

// ==== PhÃ¡t Ã¢m ====
function playPronunciation(){
  const active = getActiveWords(); if(active.length===0) return;
  const u = new SpeechSynthesisUtterance(active[currentIndex].eng);
  u.lang="en-US"; speechSynthesis.speak(u);
}

// ==== Nháº­n diá»‡n giá»ng nÃ³i ====
let recognition;
if('webkitSpeechRecognition' in window || 'SpeechRecognition' in window){
  const SR = window.SpeechRecognition||window.webkitSpeechRecognition;
  recognition=new SR(); recognition.lang="en-US";
  recognition.onresult=(e)=>{
    const active=getActiveWords(); if(active.length===0) return;
    const spoken=e.results[0][0].transcript.trim().toLowerCase();
    const expected=active[currentIndex].eng.toLowerCase();
    if(spoken===expected){ resultPronounce.textContent="âœ… Chuáº©n rá»“i"; setTimeout(nextWord,800);}
    else resultPronounce.textContent=`âŒ Báº¡n nÃ³i: ${spoken}`;
  };
}
speakBtn.addEventListener('click', ()=>{ if(recognition){ recognition.start(); resultPronounce.textContent="ğŸ¤ Äang nghe..."; } });

// ==== ThÃªm / XÃ³a / Sá»­a ====
function addWord(){
  const eng=document.getElementById('newWord').value.trim();
  const vi=document.getElementById('newMeaning').value.trim()||eng;
  const cat=document.getElementById('newCategory').value.trim()||'KhÃ¡c';
  const img=document.getElementById('newImage').value.trim();
  if(!eng) return alert("Nháº­p tá»«!");
  words.push({eng,vi,category:cat,image:img,known:false,phonetic:""});
  localStorage.setItem('words',JSON.stringify(words));
  document.getElementById('newWord').value="";
  document.getElementById('newMeaning').value="";
  document.getElementById('newCategory').value="";
  document.getElementById('newImage').value="";
  updateCategoryOptions(); renderTable(); reviewUnknown();
}
function editWord(i){
  const w=words[i];
  const newEng=prompt("Sá»­a tá»«:",w.eng)||w.eng;
  const newVi=prompt("Sá»­a nghÄ©a:",w.vi)||w.vi;
  const newCat=prompt("Sá»­a danh má»¥c:",w.category)||w.category;
  const newImg=prompt("Sá»­a URL áº£nh:",w.image)||w.image;
  Object.assign(w,{eng:newEng,vi:newVi,category:newCat,image:newImg});
  localStorage.setItem('words',JSON.stringify(words));
  updateCategoryOptions(); renderTable(); showWord();
}
function deleteWord(i){
  if(!confirm("XÃ³a tá»« nÃ y?")) return;
  words.splice(i,1); localStorage.setItem('words',JSON.stringify(words));
  updateCategoryOptions(); renderTable(); showWord();
}

// ==== ÄÃ¡nh dáº¥u ====
function markKnown(){ const a=getActiveWords(); if(!a.length) return; a[currentIndex].known=true; localStorage.setItem('words',JSON.stringify(words)); reviewUnknown(); }
function markUnknown(){ const a=getActiveWords(); if(!a.length) return; a[currentIndex].known=false; localStorage.setItem('words',JSON.stringify(words)); showWord(); }

// ==== IPA ====
async function fetchIPA(word){
  try{
    const res=await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
    const d=await res.json();
    if(d[0]?.phonetics?.length) return d[0].phonetics[0].text||word;
  }catch{}
  return word.split("").join(".");
}

// ==== áº¢nh Unsplash ====
function getUnsplashUrl(word){ return `https://source.unsplash.com/600x400/?${word}&sig=${Date.now()}`; }
function setUnsplashToInput(){
  const w=document.getElementById('newWord').value.trim();
  if(!w) return alert("Nháº­p tá»« trÆ°á»›c");
  document.getElementById('newImage').value=getUnsplashUrl(w);
}
function changeUnsplashImage(){
  const a=getActiveWords(); if(!a.length) return;
  a[currentIndex].image=getUnsplashUrl(a[currentIndex].eng);
  localStorage.setItem('words',JSON.stringify(words)); showWord(); renderTable();
}

// ==== Clipboard ====
async function pasteImageUrl(){ document.getElementById('newImage').value=await navigator.clipboard.readText(); }
async function copyCurrentImageUrl(){ const a=getActiveWords(); if(a.length&&a[currentIndex].image) await navigator.clipboard.writeText(a[currentIndex].image); }

// ==== ThÃ´ng bÃ¡o ====
function requestNotificationPermission(){ if(!("Notification"in window)) return; Notification.requestPermission(); }

// ==== Render báº£ng ====
function renderTable(){
  wordTable.innerHTML="";
  const sel=filterCategory.value;
  words.forEach((w,i)=>{
    if(sel&&w.category!==sel) return;
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${w.eng}</td><td>${w.vi}</td><td>${w.category}</td>
      <td>${w.image?`<img src="${w.image}" class="thumbnail">`:"â€”"}</td>
      <td>${w.known?"âœ”":"âŒ"}</td>
      <td><button onclick="editWord(${i})">Sá»­a</button><button onclick="deleteWord(${i})">XÃ³a</button></td>`;
    wordTable.appendChild(tr);
  });
}
function updateCategoryOptions(){
  const cats=[...new Set(words.map(w=>w.category))];
  filterCategory.innerHTML='<option value="">Táº¥t cáº£</option>';
  cats.forEach(c=>{const o=document.createElement("option");o.value=c;o.textContent=c;filterCategory.appendChild(o);});
}

// ==== Init ====
updateCategoryOptions(); renderTable(); showWord();
</script>
</body>
</html>
